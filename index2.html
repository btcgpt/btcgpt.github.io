<!DOCTYPE html>
<html>

<head>
    <title>BTCGPT</title>
    <meta name="description" content="BTCGPT predicts the price of Bitcoin.">
    <meta property="og:title" content="BTCGPT">
    <meta property="og:description" content="BTCGPT predicts the price of Bitcoin.">
    <meta property="og:image" content="./images/btc.png">
    <meta property="og:image:width" content="100">
    <meta property="og:image:height" content="100">
    <meta charset="UTF-8">
    <meta name="naver-site-verification" content="089e77bc8defc2d01087f8b2da5f8b7d4ec68efe" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700&display=swap">
    <!-- <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap"> -->


    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="./css/style.css?v=2.4">
    <link rel="icon" type="image/png" href="./images/btc.svg">    
    <!-- <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3319067300509450" crossorigin="anonymous"></script> -->
</head>

<!-- Google tag (gtag.js) -->
<!-- <script async src="https://www.googletagmanager.com/gtag/js?id=G-QC6EQ2XQ12"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-QC6EQ2XQ12');
</script> -->

<body>
    <header>
        <div class="container">
            <svg width="64" height="64">
                <image href="./images/btc.svg" style="opacity: 0.8;" />
            </svg>
            <h1 class="btcgpt">BTCGPT</h1>
            <h1>üöÄüåï</h1>
            <div id="id_text">
                <p style="text-align: center;" class="btcgpt">&nbsp;</p>
                <p style="text-align: center;" class="notice">&nbsp;</p>
                <p style="text-align: center;" class="notice">&nbsp;</p>
            </div>
        </div>
    </header>

    <video autoplay loop muted playsinline id="video-background" poster="./videos/up.png">
        <source src="./videos/rocket_launch.mp4" type="video/mp4">
    </video>

    <div id="id_container" class="container">

        <div class="card">
            <p>Hourly Forecast</p>
            <div id="id_hour">
                <p class="info" id="id_hour_next">
                    <span class="price"></span>
                    <span class="percent"></span>
                    <h4 class="bottom"><span class="datetime"></span><span id="id_hour_time_left" class="datetime"></span></h4>
                </p>
                
                <p class="info">
                    <div id="id_hour_now">
                    </div>
                    <h4 class="bottom"><span class="datetime" id="id_hour_datetime"></span></h4>
                </p>
                
                <p class="info">
                    <p class="desc" id="id_hour_gap"><span>&nbsp;</span></p>
                    <div id="id_hour_desc">
                        <p class="desc"><span></span></p>
                        <p class="desc"><span></span></p>
                    </div>
                </p>

                <p class="info">
                    <p class="predict_1 green" id="id_hour_all1">all +1h: $29,000, 1.00%</p>
                    <p class="predict_1 yellow hidden" id="id_hour_all2">all +2h: $30,000</p>
                    <p class="predict_1 orange hidden" id="id_hour_you">you +2h: $30,000</p>
                </p>
            </div>
            <canvas class="chart" id="id_hourchart" height="150"></canvas>

            <div id="id_predict_box" class="predict_box hidden">

                <!-- <div class="center">                    
                </div> -->

                <div class="slider-container">
                    <input id="id_price_slider" type="range" min="25000" max="35000" value="30000" class="slider">
                </div>

                <div class="center">
                    <input id="id_user_info" class="user_info" type="text" maxlength="50" placeholder="Enter your name">
                    <button id="id_btn_reset" class="btn">Reset</button>
                    <button id="id_btn_save" class="btn">OK</button>
                </div>
            </div>

            <div id="id_predict" class="center">
                <button id="id_btn_predict" class="btn_predict">Predict together with ‚ù§Ô∏è</button>
            </div>                

        </div>


        <div class="card">
            <p>Daily Forecast</p>
            <div id="id_day">
                <p class="info" id="id_day_next">
                    <span class="price"></span>
                    <span class="percent"></span>
                <h4 class="bottom"><span class="datetime"></span></h4>
                </p>
                <p class="info">
                <div id="id_day_now">
                </div>
                <h4 class="bottom"><span class="datetime" id="id_day_datetime"></span></h4>
                </p>
                <p class="info">
                <p class="desc" id="id_day_gap"><span>&nbsp;</span></p>
                <div id="id_day_desc">
                    <p class="desc"><span></span></p>
                    <p class="desc"><span></span></p>
                </div>
                <p class="info">
                    <p class="predict_1 green" id="id_day_all1">all +1d: $29,000</p>
                    <p class="predict_1 yellow hidden" id="id_day_all2">all +2d: $30,000</p>
                    <p class="predict_1 orange hidden" id="id_day_you">you +2d: $30,000</p>
                </p>  
            </div>
            <canvas class="chart" id="id_daychart" height="150"></canvas>
        </div>

        <div class="card">
            <p>Weekly Forecast</p>
            <div id="id_week">
                <p class="info" id="id_week_next">
                    <span class="price"></span>
                    <span class="percent"></span>
                <h4 class="bottom"><span class="datetime"></span></h4>
                </p>
                <p class="info" id="id_week_now">
                <div id="id_week_now">
                </div>
                <h4 class="bottom"><span class="datetime" id="id_week_datetime"></span></h4>
                </p>
                <p class="info">
                <p class="desc" id="id_week_gap"><span>&nbsp;</span></p>
                <div id="id_week_desc">
                    <p class="desc"><span></span></p>
                    <p class="desc"><span></span></p>
                </div>
                <p class="info">
                    <p class="predict_1 green" id="id_week_all1">all +1w: $29,000</p>
                    <p class="predict_1 yellow hidden" id="id_week_all2">all +2w: $30,000</p>
                    <p class="predict_1 orange hidden" id="id_week_you">you +2w: $30,000</p>
                </p>  
            </div>
            <canvas class="chart" id="id_weekchart" height="150"></canvas>
        </div>

        <div class="card">
            <p class="sm_text">What is BTCGPT?</p>
            <p>
                <span class="sm_text">
                    BTCGPT is a deep learning model that predicts the future price of Bitcoin based on past Bitcoin
                    prices, as well as other relevant data such as trading volumes, market capitalization, and news
                    sentiment analysis. These models are typically trained using historical data and fine-tuned with
                    more recent data to improve their accuracy.
                    It is important to note that while these models may provide valuable insights, they are not
                    foolproof and cannot predict the future with complete certainty. Market conditions, economic
                    factors, and other unpredictable variables can impact the price of Bitcoin and other assets.
                    Therefore, it is recommended that investors use BTCGPT's predictions as just one tool to inform
                    their investment decisions and always conduct their own research before making any investment
                    decisions.
                </span>
            </p>
        </div>

        <div class="card">
            <p class="sm_text">Why are the hourly, daily and weekly price predictions different?</p>
            <p>
                <span class="sm_text">
                    Ideally, we would like all models to provide the same predictions, but in reality, due to
                    differences in the training data and model architecture, they may produce different results. The
                    hourly and daily models use more recent data and incorporates more short-term market trends, while
                    the weekly model uses a longer time frame and focuses on broader market trends.
                </span>
            </p>
        </div>

        <!-- <div class="card">
            <p class="sm_text">What is Average Directional Accuracy?</p>
            <p>
                <span class="sm_text">
                    Directional accuracy(DA) is a metric that measures how closely the predicted price and the actual
                    price of an asset move in the same direction. For example, if the predicted price for the next day
                    is higher and the actual price also increases, the DA result would be True (1). However, if the
                    actual price moves in the opposite direction, the result would be False (0).
                    The N-day average directional accuracy (ADA) is calculated by summing up the DA results over N days
                    and dividing the total by N. For example, if the DA results for the last 5 days are [1, 0, 1, 1, 1],
                    the 5-day ADA would be (1+0+1+1+1)/5 = 0.8.
                    The chart displays the moving ADA over a 5-day period.
                </span>
            </p>
        </div> -->
        <div class="card">
            <p class="sm_text">Updates.</p>
            <p><span class="sm_text">‚úÖ BTCGPT(alpha) launched. (2023-04-11)</span>
            <p><span class="sm_text">‚úÖ accuracy improved, bug fix. (2023-04-17)</span>
            <p><span class="sm_text">‚úÖ added: analysis metrics. (2023-04-19)</span>
            <p><span class="sm_text">‚úÖ updated: ux text. (2023-04-20)</span>
            <p><span class="sm_text">‚úÖ updated: prediciton model (2023-04-26)</span>
            <p><span class="sm_text">‚úÖ added: hourly forecast. (2023-04-26)</span>
            <p><span class="sm_text">‚úÖ BTCGPT(beta) launched. (2023-04-28)</span>
            </p>
        </div>

        <div class="card">
            <p class="sm_text">Contact.</p>

            <!-- <p>
                <span class="notice_orange">
                    Please ask any questions on r/Bitcoin.
                    <a href="https://www.reddit.com/r/Bitcoin/comments/12lf2vn/btcgpt_predicts_bitcoin_price_your_fun_bitcoin/" target="_blank" style="color: rgb(255, 255, 255);">Go to Bitcoin r/Bitcoin</a>.
                </span>
            </p>
            <p>
                <span class="notice_orange">
                    Previous post was deleted by moderator but comments can still be seen here.
                    <a href="https://www.reddit.com/r/Bitcoin/comments/12kj6gq/btcgpt_predicts_bitcoin_price_your_fun_bitcoin/" target="_blank" style="color: rgb(255, 255, 255);">Go to Bitcoin r/Bitcoin</a>.
                </span>
            </p> -->

            <!-- <p>
                <span class="notice_orange">
                    Please ask any questions on BitcoinTalk.
                    <a href="https://bitcointalk.org/index.php?topic=5448757.0" target="_blank" style="color: rgb(255, 255, 255);">Go to BitcoinTalk.</a>.
                </span>
            </p> -->

            <span class="sm_text">
                If you have any questions, please send me an email.
                <span class="notice_green">
                    btcgpt @ gmail.com
                </span>
            </span>

        </div>

    </div>

    <footer class="sm_text" style="text-align: center;">
        <div style="text-align: center;"><img src="./images/captainbtc.jpg" alt="CaptainBTC" style="width: 60px; height: 60px; margin-right: 0px; border-radius: 50%;"></div>
        &copy; 2023 BTCGPT.INFO
    </footer>

    <!-- <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation/dist/chartjs-plugin-annotation.min.js"></script>

    <script>
        charts = []
        function create_charts() {
            Chart.defaults.color = "white";
            ctx = document.getElementById('id_hourchart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'Actual',
                        // data: data.day.actual,
                        //fill: true,
                        borderWidth: 1,
                        pointRadius: 2,
                        //tension: 0.5,
                        backgroundColor: 'rgba(0, 255, 0, 0.8)',
                        borderColor: 'rgba(0, 255, 0, 1)'
                    },
                    {
                        label: 'Pred:Past',
                        //data: data.day.pred_past,
                        fill: true,
                        borderWidth: 1,
                        //pointStyle: false,
                        pointRadius: 2,
                        // hidden: true, // Set the dataset to be hidden initially
                        backgroundColor: 'rgba(33, 146, 255, 0.8)',
                        borderColor: 'rgba(33, 146, 255, 1)'
                    },
                    {
                        label: 'Now',
                        //data: data.day.now_s,
                        //fill: true,
                        borderWidth: 1,
                        //pointRadius: 2,
                        pointRadius: [2, 2],
                        backgroundColor: 'rgba(255, 255, 255, 0.9)',
                        borderColor: 'rgba(255, 255, 255, 1)'
                    },
                    {
                        id: "future",
                        label: 'Pred:Future',
                        //data: data.day.pred_future,
                        fill: true,
                        borderWidth: 1,
                        pointRadius: 2,
                        backgroundColor: 'rgba(33, 146, 255, 0.3)',
                        borderColor: 'rgba(33, 146, 255, 1)'
                    }]
                },
                options: {
                    scales: {
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                font: {
                                    size: 8
                                }
                            },
                            display: false
                        },
                        y: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                font: {
                                    size: 8
                                },
                                beginAtZero: false,
                            },
                            // position: "right"
                        },
                    },
                    plugins: {
                        title: {
                            display: false,
                            text: 'Daily Forecast',
                            font: {
                                size: 16, // Set the title font size here
                                weight: 'normal' // Set the title font weight to normal
                            }
                        },
                        legend: {
                            display: true,
                            position: 'bottom',
                            labels: {
                                font: {
                                    size: 10 // Set the legend label font size here
                                },
                                boxWidth: 10 // Set the box size for the legend labels
                            }
                        },

                        annotation: {
                            annotations: {                    
                                line_all1: {
                                    mode: "horizontal",
                                    type: 'line',
                                    yMin: 29000,
                                    yMax: 29000,
                                    borderColor: "white",
                                    borderWidth: 1,
                                    borderDash: [1, 1],
                                    display: false,
                                },
                                line_all2: {
                                    mode: "horizontal",
                                    type: 'line',
                                    yMin: 29050,
                                    yMax: 29050,
                                    borderColor: "white",
                                    borderWidth: 1,
                                    borderDash: [1, 1],
                                    display: false,
                                },
                                line_you: {
                                    mode: "horizontal",
                                    type: 'line',
                                    yMin: 28000,
                                    yMax: 28000,
                                    borderColor: "white",
                                    borderWidth: 1,
                                    borderDash: [1, 1],
                                    display: false,
                                },
                                point_all1: {
                                    type: 'point',
                                    borderColor: 'green',
                                    borderWidth: 0,
                                    backgroundColor: 'green',
                                    radius: 3,
                                    xValue: 100,
                                    yValue: 29500,
                                    display: false,
                                },
                                point_all2: {
                                    type: 'point',
                                    borderColor: 'yellow',
                                    borderWidth: 0,
                                    backgroundColor: 'yellow',
                                    radius: 3,
                                    xValue: 101,
                                    yValue: 29000,
                                    display: false,
                                },                                                                
                                point_you: {
                                    type: 'point',
                                    borderColor: 'orange',
                                    borderWidth: 0,
                                    backgroundColor: 'orange',
                                    radius: 3,
                                    xValue: 101,
                                    yValue: 30100,
                                    display: false,
                                },
                                label_all1: {
                                    type: 'label',
                                    xValue: 20,
                                    yValue: 29000,
                                    backgroundColor: '#00000077',
                                    content: ["all +1h"],
                                    color: "white",
                                    display: false,
                                    font: {
                                        size: 11,                                        
                                    }
                                },
                                label_all2: {
                                    type: 'label',
                                    xValue: 40,
                                    yValue: 29000,
                                    backgroundColor: '#00000077',
                                    content: ["all +2h"],
                                    color: "white",
                                    display: false,
                                    font: {
                                        size: 11,
                                    }
                                },                                
                                label_you: {
                                    type: 'label',
                                    xValue: 60,
                                    yValue: 25100,
                                    backgroundColor: '#00000077',
                                    content: ["you +2h"],
                                    color: "white",
                                    display: false,
                                    font: {
                                        size: 11,
                                    }
                                },
                                // label_gazua: {
                                //     type: 'label',
                                //     xValue: 60,
                                //     yValue: 30200,
                                //     // backgroundColor: '#00000077',
                                //     content: ["üöÄ"],
                                //     color: "white",
                                //     display: true,
                                //     font: {
                                //         size: 21,
                                //         // family: 'Press Start 2P'
                                //         // weight: 'bold'
                                //         //Chart.defaults.global.defaultFontFamily = 'Bebas Neue';
                                //     }                       
                                // },
                            },
                        },                        
                    },


                    // animation: {
                    //     duration: 2000,
                    //     easing: "linear"
                    // }
                }
            });
            charts.push(chart)

            ctx = document.getElementById('id_daychart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'Actual',
                        // data: data.day.actual,
                        //fill: true,
                        borderWidth: 1,
                        pointRadius: 2,
                        backgroundColor: 'rgba(0, 255, 0, 0.8)',
                        borderColor: 'rgba(0, 255, 0, 1)'
                    },
                    {
                        label: 'Pred:Past',
                        //data: data.day.pred_past,
                        fill: true,
                        borderWidth: 1,
                        //pointStyle: false,
                        pointRadius: 2,
                        // hidden: true, // Set the dataset to be hidden initially
                        backgroundColor: 'rgba(255, 159, 64, 0.8)',
                        borderColor: 'rgba(255, 159, 64, 1)'
                    },
                    {
                        label: 'Now',
                        //data: data.day.now_s,
                        //fill: true,
                        borderWidth: 1,
                        pointRadius: [2, 2],
                        backgroundColor: 'rgba(255, 255, 255, 0.9)',
                        borderColor: 'rgba(255, 255, 255, 1)'
                    },
                    {
                        label: 'Pred:Future',
                        //data: data.day.pred_future,
                        fill: true,
                        borderWidth: 1,
                        pointRadius: 2,
                        backgroundColor: 'rgba(255, 159, 64, 0.3)',
                        borderColor: 'rgba(255, 159, 64, 1)'
                    }]
                },
                options: {
                    scales: {
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                font: {
                                    size: 8
                                }
                            },
                            display: false
                        },
                        y: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                font: {
                                    size: 8
                                },
                            },
                            // position: "right"
                        },
                    },
                    plugins: {
                        title: {
                            display: false,
                            text: 'Daily Forecast',
                            font: {
                                size: 16, // Set the title font size here
                                weight: 'normal' // Set the title font weight to normal
                            }
                        },
                        legend: {
                            display: true,
                            position: 'bottom',
                            labels: {
                                font: {
                                    size: 10 // Set the legend label font size here
                                },
                                boxWidth: 10 // Set the box size for the legend labels
                            }
                        },
                    }
                }
            });
            charts.push(chart)

            ctx = document.getElementById('id_weekchart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'Actual',
                        //data: data.week.actual,
                        //fill: true,
                        borderWidth: 1,
                        pointRadius: 2,
                        backgroundColor: 'rgba(0, 255, 0, 0.9)',
                        borderColor: 'rgba(0, 255, 0, 1)'
                    },
                    {
                        label: 'Pred:Past',
                        //data: data.week.pred_past,
                        fill: true,
                        borderWidth: 1,
                        //pointStyle: false,
                        pointRadius: 2,
                        //hidden: true, // Set the dataset to be hidden initially
                        backgroundColor: 'rgba(255, 99, 132, 0.8)',
                        borderColor: 'rgba(255, 99, 132, 1)'
                    },
                    {
                        label: 'Now',
                        //data: data.week.now_s,
                        //fill: true,
                        borderWidth: 1,
                        pointRadius: [2, 2],
                        backgroundColor: 'rgba(255, 255, 255, 0.9)',
                        borderColor: 'rgba(255, 255, 255, 1)'
                    },
                    {
                        label: 'Pred:Future',
                        //data: data.week.pred_future,
                        fill: true,
                        borderWidth: 1,
                        pointRadius: 2,
                        backgroundColor: 'rgba(255, 99, 132, 0.3)',
                        borderColor: 'rgba(255, 99, 132, 1)'
                    }]
                },
                options: {
                    scales: {
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                font: {
                                    size: 8
                                }
                            },
                            display: false
                        },
                        y: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                font: {
                                    size: 8
                                }
                            },
                            // position: "right"                            
                        },
                    },
                    plugins: {
                        title: {
                            display: false,
                            text: 'Weekly Forecast',
                            font: {
                                size: 16, // Set the title font size here
                                weight: 'normal' // Set the title font weight to normal
                            }
                        },
                        legend: {
                            display: true,
                            position: 'bottom',
                            labels: {
                                font: {
                                    size: 10 // Set the legend label font size here
                                },
                                boxWidth: 10 // Set the box size for the legend labels
                            }
                        },
                    }
                }
            });
            charts.push(chart)

            container = document.getElementById('id_container');
            resizeObserver = new ResizeObserver(() => {
                charts.forEach(chart => {
                    chart.resize();
                });
            });
            resizeObserver.observe(container);

        }

        function get_info(data) {

            info = {}

            next_price = data.pred_future.slice(0)[0]['y']
            last_price = data.actual.slice(-1)[0]['y']
            next_percent = (next_price - last_price) * 100 / last_price

            info.next_price = formatPrice(next_price)
            info.next_percent = formatPercent(next_percent) + data.percent

            if (next_percent < 0) {
                info.c_next = "down"
            } else if (next_percent > 0) {
                info.c_next = "up"
            } else {
                info.c_next = "eq"
            }

            if (next_price > last_price) {
                info.actual_to_next = "up üöÄ"
            } else if (next_price < last_price) {
                info.actual_to_next = "down üò±"
            } else {
                info.actual_to_next = "same üòê"
            }

            pred_past_price = data.pred_past.slice(-1)[0]['y']
            if (next_price > pred_past_price) {
                info.past_to_next = "up üöÄ"
            } else if (next_price < pred_past_price) {
                info.past_to_next = "down üò±"
            } else {
                info.past_to_next = "same üòê"
            }

            info.datetime = data.pred_future[0]['x']

            info.id_next = data.id_next
            info.id_desc = data.id_desc
            info.id_time_left = data.id_time_left


            all1_price = data.all.future.slice(0)[0]['y']
            all1_percent = (all1_price - last_price) * 100 / last_price
            info.all1_price = formatPrice(all1_price)
            info.all1_percent = formatPercent(all1_percent)

            all2_price = data.all.future.slice(1)[0]['y']
            all2_percent = (all2_price - last_price) * 100 / last_price
            info.all2_price = formatPrice(all2_price)
            info.all2_percent = formatPercent(all2_percent)

            // gap_avg_abs(data.actual, data.pred_past)

            return info
        }

        function gap_avg_abs(y_true, y_pred) {
            let l_true = [];
            let l_pred = [];

            y_true.forEach((item, index) => {
                l_true.push(item['y']);
                l_pred.push(y_pred[index]['y']);
            });

            let abs_diff = l_true.reduce((sum, val, index) => sum + Math.abs(val - l_pred[index]) / val, 0);
            let avg_abs_diff = abs_diff * 100 / l_true.length;

            console.log("Average absolute difference:", formatPercent(avg_abs_diff));
        }

        last_data = null
        last_data_str = null

        utc_hour = null
        utc_day = null
        utc_week = null

        function reload() {
            //fetch the JSON data from the file
            // fetch("https://raw.githubusercontent.com/btcgpt/data/main/output.json", { cache: 'no-cache', })
            fetch("./output.json", { cache: 'no-cache', })            
            .then(response => response.json())
            .then(data => {
                temp = JSON.stringify(data);
                if (temp == last_data_str) {
                    //console.log("no change")
                    return
                }
                last_data = data
                last_data_str = temp

                // prepare to display
                data.hour.id_next = "id_hour_next"
                data.day.id_next = "id_day_next"
                data.week.id_next = "id_week_next"

                data.hour.id_desc = "id_hour_desc"
                data.day.id_desc = "id_day_desc"
                data.week.id_desc = "id_week_desc"

                data.hour.id_time_left = "id_hour_time_left"
                data.day.id_time_left = "id_day_time_left"
                data.week.id_time_left = "id_week_time_left"

                data.hour.percent = "% +1h"
                data.day.percent = "% +1d"
                data.week.percent = "% +1w"

                data.hour.all1 = "id_hour_all1"
                data.day.all1 = "id_day_all1"
                data.week.all1 = "id_week_all1"

                data.hour.all2 = "id_hour_all2"
                data.day.all2 = "id_day_all2"
                data.week.all2 = "id_week_all2"

                data.hour.chart = charts[0]
                data.day.chart = charts[1]
                data.week.chart = charts[2]

                mylist = [data.hour, data.day, data.week]
                mylist.forEach(item => {

                    info = get_info(item)

                    temp = `
                    <p class="info">
                        <span class="price ${info.c_next}">${formatPrice(info.next_price)}</span>
                        <span class="percent ${info.c_next}">${formatPercent(info.next_percent)}</span>
                        <h4 class="bottom">
                            <span class="datetime ${info.c_next}">${info.datetime}:00 UTC,</span>
                            <span id="${info.id_time_left}" class="datetime ${info.c_next}"> 00:00:00</span>
                        </h4>
                    </p>`

                    document.getElementById(info.id_next).innerHTML = temp;

                    temp = `
                        <div>                      
                            <p class="desc"><span>actual to next: ${info.actual_to_next}</span></p>
                            <p class="desc"><span>pred:past to next: ${info.past_to_next}</span></p>
                        </div>
                    `
                    document.getElementById(info.id_desc).innerHTML = temp;


                    document.getElementById(item.all1).innerHTML = `all +1d: ${info.all1_price}, ${info.all1_percent}%`;
                    document.getElementById(item.all2).innerHTML = `all +2d: ${info.all2_price}, ${info.all2_percent}%`;


                    // <p class="predict_1 green" id="id_hour_all1">all +1h: $29,000, 1.00%</p>
                    // <p class="predict_1 yellow hidden" id="id_hour_all2">all +2h: $30,000</p>
                    // <p class="predict_1 orange hidden" id="id_hour_you">you +2h: $30,000</p>

                    item.chart.data.datasets[0].data = item.actual;
                    item.chart.data.datasets[1].data = item.pred_past;
                    item.chart.data.datasets[2].data = item.now_s;
                    item.chart.data.datasets[3].data = item.pred_future;
                    item.chart.update();

                })
            })
        }

        create_charts();

        reload();

        //setInterval(reload, 1 * 5 * 1000);
        setInterval(reload, 1 * 5 * 1000 * 10);

        function getNowDateString(now) {
            const year = now.getUTCFullYear();
            const month = (now.getUTCMonth() + 1).toString().padStart(2, '0');
            const day = now.getUTCDate().toString().padStart(2, '0');
            const hours = now.getUTCHours().toString().padStart(2, '0');
            const minutes = now.getUTCMinutes().toString().padStart(2, '0');
            const seconds = now.getUTCSeconds().toString().padStart(2, '0');
            const time_now = `${year}-${month}-${day} ${hours}:${minutes}:${seconds} UTC`;

            return time_now;
        }

        function getCountdownDateString(date, now) {
            targetTime = new Date(date);
            //currentTime = new Date();
            var utc = new Date(now.getTime() + now.getTimezoneOffset() * 60000);
            timeDiff = targetTime.getTime() - utc.getTime();
            hours = Math.floor(timeDiff / (1000 * 60 * 60)).toString().padStart(2, '0');
            minutes = Math.floor((timeDiff / (1000 * 60)) % 60).toString().padStart(2, '0');
            seconds = Math.floor((timeDiff / 1000) % 60).toString().padStart(2, '0');

            time = `-${hours}:${minutes}:${seconds}`;
            if (hours < 0) {
                time = "Predicting...üßòüèª"
            }
            return time
        }

        function updateTime(now) {
            if (last_data != null) {

                now = new Date();
                document.getElementById('id_hour_time_left').innerHTML = getCountdownDateString(last_data.hour.pred_future[0]['x'], now);
                document.getElementById('id_day_time_left').innerHTML = getCountdownDateString(last_data.day.pred_future[0]['x'], now);
                document.getElementById('id_week_time_left').innerHTML = getCountdownDateString(last_data.week.pred_future[0]['x'], now);

                date_now = getNowDateString(now)
                document.getElementById('id_hour_datetime').innerHTML = date_now
                document.getElementById('id_day_datetime').innerHTML = date_now
                document.getElementById('id_week_datetime').innerHTML = date_now
            }

            charts.forEach(chart => {
                if (chart.data.datasets[2].pointRadius[1] == 2) {
                    chart.data.datasets[2].pointRadius[1] = 5
                } else {
                    chart.data.datasets[2].pointRadius[1] = 2
                }
                chart.update();
            });
        }
        setInterval(updateTime, 5000);


        LANGUAGES = ["zh", "es", "en", "ar", "pt", "bn", "ru", "ja", "ko", "fr", "de", "it", "tr", "hi", "fa", "th", "pl", "ur", "nl"]
        function detectLanguage() {
            const userLang = navigator.language || navigator.userLanguage;
            const langCode = userLang.split('-')[0];
            if (LANGUAGES.includes(langCode)) {
                return langCode;
            }
            return 'en';
        }

        function updateContent(language) {
            fetch('./text/language.json', { cache: 'no-cache' })
            .then(response => response.json())
            .then(data => {
                const content = data[language];
                const textElement = document.querySelector('#id_text');
                // Ìï¥Îãπ Ïñ∏Ïñ¥Ïóê ÎåÄÌïú ÎÇ¥Ïö©ÏúºÎ°ú Î¨∏ÏÑú Í∞ùÏ≤¥Î•º Î≥ÄÍ≤ΩÌï©ÎãàÎã§.
                textElement.innerHTML = `
                <p style="text-align: center;" class="btcgpt">${content.text}</p>
                <p style="text-align: center;" class="notice">${content.notice1}</p>            
                <p style="text-align: center;" class="notice">${content.notice2}</p>`;
            })
            .catch(error => {
                console.error('Error fetching language data:', error);
            });
        }

        window.onload = function () {
            const language = detectLanguage();
            updateContent(language);
        };

        function formatPrice(price) {
            return price.toLocaleString('en-US', {
                style: 'currency',
                currency: 'USD',
            }).replace(/\.(\d\d)/, '');
        }

        function formatPercent(number) {
            return number.toLocaleString('en-US', {
                style: 'decimal',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }

        last_btc_price = null
        function getPrice() {
            const url = 'https://api.binance.com/api/v3/ticker/price?symbol=BTCUSDT';
            fetch(url)
                .then(response => response.json())
                .then(data => {

                    if (last_data != null) {

                        price_now = Math.round(data.price);
                        if(last_btc_price == price_now) {
                            return;
                        }
                        last_btc_price = price_now

                        // hour
                        price_last = last_data.hour.actual.slice(-1)[0]['y']
                        percent_now = (price_now - price_last) * 100 / price_last;

                        temp = `
                             <span class="price">${formatPrice(price_now)}</span>
                             <span class="percent">${formatPercent(percent_now)}% now</span>
                        `
                        document.getElementById('id_hour_now').innerHTML = temp

                        price_next = last_data.hour.pred_future.slice(0)[0]['y']
                        percent_next = (price_next - price_last) * 100 / price_last;
                        price_percent_gap = percent_now - percent_next
                        if (price_percent_gap > 0)
                            direction = 'up'
                        else if (price_percent_gap < 0)
                            direction = 'down'
                        else
                            direction = 'same'
                        temp = `<span class="${direction}">gap: ${formatPercent(price_percent_gap)}%</span>`
                        document.getElementById('id_hour_gap').innerHTML = temp

                        // day
                        price_last = last_data.day.actual.slice(-1)[0]['y']
                        percent_now = (price_now - price_last) * 100 / price_last;

                        temp = `
                             <span class="price">${formatPrice(price_now)}</span>
                             <span class="percent">${formatPercent(percent_now)}% now</span>
                        `
                        document.getElementById('id_day_now').innerHTML = temp

                        price_next = last_data.day.pred_future.slice(0)[0]['y']
                        percent_next = (price_next - price_last) * 100 / price_last;
                        price_percent_gap = percent_now - percent_next
                        if (price_percent_gap > 0)
                            direction = 'up'
                        else if (price_percent_gap < 0)
                            direction = 'down'
                        else
                            direction = 'same'
                        temp = `<span class="${direction}">gap: ${formatPercent(price_percent_gap)}%</span>`
                        document.getElementById('id_day_gap').innerHTML = temp

                        // week
                        price_last = last_data.week.actual.slice(-1)[0]['y']
                        percent_now = (price_now - price_last) * 100 / price_last;

                        temp = `
                             <span class="price">${formatPrice(price_now)}</span>
                             <span class="percent">${formatPercent(percent_now)}% now</span>
                        `
                        document.getElementById('id_week_now').innerHTML = temp

                        price_next = last_data.week.pred_future.slice(0)[0]['y']
                        percent_next = (price_next - price_last) * 100 / price_last;
                        price_percent_gap = percent_now - percent_next
                        price_percent_gap = percent_now - percent_next
                        if (price_percent_gap > 0)
                            direction = 'up'
                        else if (price_percent_gap < 0)
                            direction = 'down'
                        else
                            direction = 'same'
                        temp = `<span class="${direction}">gap: ${formatPercent(price_percent_gap)}%</span>`
                        document.getElementById('id_week_gap').innerHTML = temp

                        for (chart of charts) {
                            chart.data.datasets[2].data[1]['y'] = price_now
                            chart.update();
                        }
                    }
                })
                .catch(error => console.error(error));
        }
        getPrice();
        setInterval(getPrice, 15000); // test


        // init prediction controls
        const slider = document.getElementById("id_price_slider");
        const price_you = document.getElementById("id_price_you");

        slider.oninput = function () {
            update_slider(this.value)
        };

        function update_slider(value) {
            // all+1h Í∏∞Ï§ÄÏúºÎ°ú % ÏÇ∞Ï†ï
            price_you.innerHTML = "you +2h: " + formatPrice(parseInt(value)); // you: $30,000 2% +2h
            
            charts[0].options.plugins.annotation.annotations['line_you'].yMin= value;
            charts[0].options.plugins.annotation.annotations['line_you'].yMax = value;
            charts[0].options.plugins.annotation.annotations['label_you'].yValue= value;        
            charts[0].options.plugins.annotation.annotations['point_you'].yValue= value;  
            charts[0].update();

            // charts[0].options.plugins.annotation.annotations['label1'].yValue = this.value            
        }

        slider.addEventListener("mousedown", function () {
            console.log("Thumb clicked");
            charts[0].options.animation = false;
            charts[0].update();
        });

        slider.addEventListener("mouseup", function () {
            console.log("Thumb released");
            charts[0].options.animation = true;
            charts[0].update();
        });

        slider.addEventListener("touchstart", function () {
            console.log("Thumb touched");
            charts[0].options.animation = false;
            charts[0].update();
        });

        slider.addEventListener("touchend", function () {
            console.log("Thumb released");
            charts[0].options.animation = true;
            charts[0].update();
        });            
        
        const id_predict_box = document.getElementById('id_predict_box');
        const id_predict = document.getElementById('id_predict');


        const id_btn_predict = document.getElementById('id_btn_predict');
        id_btn_predict.addEventListener('click', function () {
            // get current price
            if (last_btc_price == null)
                return // return, if price_now is not set
            
            reset_slider();

            id_predict.classList.add('hidden');
            id_predict_box.classList.remove('hidden');
        });

        function reset_slider() {

            last_price = last_data.hour.actual.slice(-1)[0].y

            // set slider value to current price
            // slider min = price_now * 0.97, max = price_now * 1.03
            slider.value = last_price;
            slider.min = Math.round(slider.value * 0.70);
            slider.max = Math.round(slider.value * 1.30);
            charts[0].options.plugins.annotation.annotations['line_you'].display = true;
            update_slider(slider.value);
        }

        const id_btn_reset = document.getElementById('id_btn_reset');
        id_btn_reset.addEventListener('click', function () {
            reset_slider();
        });        


        const id_btn_save = document.getElementById('id_btn_save');
        id_btn_save.addEventListener('click', function () {
            charts[0].options.plugins.annotation.annotations['line_you'].display = false;
            charts[0].update();
            id_predict.classList.remove('hidden');
            id_predict_box.classList.add('hidden');
        });
    </script>    

</body>

</html>